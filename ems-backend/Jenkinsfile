pipeline {
    agent any

    environment {
        // Define the Maven tool name (configure in Jenkins tool settings)
        MAVEN_TOOL = 'Maven3.8.4'
    }

    stages {
        stage('Checkout') {
            steps {
                // Clone only the subdirectory of your GitHub repository
                sh "git clone --depth 1 --branch main https://github.com/Pratik-kale/Spring_boot_begineer.git Spring_boot_begineer/ems-backend"
            }
        }

        stage('Build and Test') {
            steps {
                // Change the working directory to your project's directory
                dir('Spring_boot_begineer/ems-backend') {
                    // Use the configured Maven tool
                    script {
                        def mvnHome = tool name: MAVEN_TOOL, type: 'hudson.tasks.Maven$MavenInstallation'
                        // Build and test the Spring Boot application
                        sh "${mvnHome}/bin/mvn clean package"
                        sh "${mvnHome}/bin/mvn test"
                    }
                }
            }
        }

        // Add more stages as needed for additional tasks (e.g., integration tests)
    }

    post {
        success {
            // Notify about successful build and tests
            echo 'Build and tests were successful!'
        }
        failure {
            // Notify or handle build or test failures
            echo 'Build or tests failed!'
        }
    }
}
